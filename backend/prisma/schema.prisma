generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Category {
  id                Int                @id @default(autoincrement())
  nom               String             @unique
  icone             String
  couleur           String             @default("#E2E8F0")
  categoryBudgets   CategoryBudget[]
  expenses          Expense[]
  recurringExpenses RecurringExpense[]
}

model Expense {
  id                 Int               @id @default(autoincrement())
  montant            Decimal           @db.Decimal(10, 2)
  description        String?
  date               DateTime
  mois               String
  categorieId        Int
  createdAt          DateTime          @default(now())
  recurringExpenseId Int?
  type               String            @default("expense")
  isShared           Boolean?          @default(false)
  sharePercentage    Decimal?          @db.Decimal(5, 2)
  categorie          Category          @relation(fields: [categorieId], references: [id])
  recurringExpense   RecurringExpense? @relation(fields: [recurringExpenseId], references: [id])

  @@index([mois])
  @@index([recurringExpenseId])
  @@index([categorieId], map: "Expense_categorieId_fkey")
}

model RecurringExpense {
  id          Int       @id @default(autoincrement())
  montant     Decimal   @db.Decimal(10, 2)
  description String?
  categorieId Int
  active      Boolean   @default(true)
  startDate   DateTime  @default(now())
  createdAt   DateTime  @default(now())
  expenses    Expense[]
  categorie   Category  @relation(fields: [categorieId], references: [id])

  @@index([categorieId], map: "RecurringExpense_categorieId_fkey")
}

model MonthlyBudget {
  id              Int              @id @default(autoincrement())
  month           String           @unique
  globalLimit     Decimal          @db.Decimal(10, 2)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  categoryBudgets CategoryBudget[]
}

model CategoryBudget {
  id              Int           @id @default(autoincrement())
  monthlyBudgetId Int
  categoryId      Int
  limit           Decimal       @db.Decimal(10, 2)
  isDisabled      Boolean       @default(false)
  category        Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  monthlyBudget   MonthlyBudget @relation(fields: [monthlyBudgetId], references: [id], onDelete: Cascade)

  @@unique([monthlyBudgetId, categoryId])
  @@index([categoryId], map: "CategoryBudget_categoryId_fkey")
}

model Setting {
  key   String @id
  value String
}
